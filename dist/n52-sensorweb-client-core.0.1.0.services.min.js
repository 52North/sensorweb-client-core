/*! n52-sensorweb-client-core.0.1.0 */
angular.module("n52.core.alert",[]).factory("alertService",["$translate",function(a){function b(b){d(a.instant("inform.error"),b)}function c(b){d(a.instant("inform.warn"),b)}function d(a,b){alert(a+"\n"+b)}return{error:b,warn:c}}]),angular.module("n52.core.barChart",[]).factory("barChartHelperService",function(){function a(a){switch(a){case"byHour":return 1;case"byDay":return 24;case"byWeek":return 168;case"byMonth":return 720;default:return 1}}function b(b,c){for(var d=[],e=a(c),f=0,g=b[f];g;){for(var h=g[0],i=moment(g[0]).add(e,"hours"),j=0;g&&moment(g[0]).isBefore(i);)f++,j+=g[1],g=b[f];d.push([h,j])}return d}return{intervalToHour:a,sumForInterval:b}}),angular.module("n52.core.color",[]).factory("colorService",["settingsService",function(a){function b(a){for(var b=0,c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);return b}function c(a){var b=(a>>16&255).toString(16)+(a>>8&255).toString(16)+(255&a).toString(16);for(b=b.toString();b.length<6;)b="0"+b;return b}var d=["#1abc9c","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#d35400","#c0392b","#7f8c8d"],e=a.colorList||d;return{stringToColor:function(a){return a?"#"+c(b(a)):"#000000"},colorList:e}}]),angular.module("n52.core.favorite",["LocalStorageModule"]).factory("favoriteService",["localStorageService","$translate","settingsService","interfaceService",function(a,b,c,d){function e(){a.set(p,q)}function f(a,b){return b=b||a.label,q[a.internalId]={id:a.internalId,label:b,type:"single",timeseries:angular.copy(a)},e(),b}function g(a,c){var d=[];return angular.forEach(a,function(a){d.push(angular.copy(a))}),0!==d.length?(c=c||b.instant("favorite.label")+" "+r,q[r]={id:r,label:c,type:"group",collection:d},e(),r++,c):null}function h(a){delete q[a],e()}function i(a){return angular.isObject(q[a])}function j(){return Object.keys(q).length>0}function k(){return Object.keys(q).length}function l(){angular.forEach(q,function(a){h(a.id)})}function m(a){l(),angular.forEach(a,function(a){if(a.timeseries&&n(a.timeseries)){var b=a.timeseries;d.getTimeseries(b.id,b.apiUrl).then(function(c){c.styles=b.styles,f(c,a.label)})}if(a.collection){var c=0,e=[];angular.forEach(a.collection,function(b){n(b)&&(c++,d.getTimeseries(b.id,b.apiUrl).then(function(d){d.styles=b.styles,e.push(d),c--,0===c&&g(e,a.label)}))})}}),e()}function n(a){var b=!1;return angular.forEach(c.restApiUrls,function(c,d){angular.equals(d,a.apiUrl)&&(b=!0)}),b}function o(a,b){q[a.id].label=b,e()}var p="favorites",q={},r=Object.keys(q).length;return m(a.get(p)),{addFavorite:f,addFavoriteGroup:g,hasFavorite:i,hasFavorites:j,setFavorites:m,removeFavorite:h,changeLabel:o,getFavoritesCount:k,favorites:q}}]).factory("favoriteImExportService",["favoriteService","$translate","alertService","utils",function(a,b,c,d){function e(e){if(d.isFileAPISupported()&&angular.isObject(e)){var f=!0;if(a.hasFavorites()&&(f=confirm(b.instant("favorite.import.override"))),f){var g=e.target.files;if(g&&g.length>0){var h=new FileReader;h.readAsText(g[0]),h.onerror=function(){c.error(b.instant("favorite.import.wrongFile"))},h.onload=$.proxy(function(b){a.setFavorites(angular.fromJson(b.target.result))},this)}}}}function f(){if(d.isFileAPISupported()){var b="favorites.json",c=angular.toJson(a.favorites,2);if(window.navigator.msSaveBlob){var e=new Blob([c],{type:"application/json;charset=utf-8;"});window.navigator.msSaveBlob(e,b)}else{var f=document.createElement("a");f.href="data:application/json,"+encodeURIComponent(c),f.target="_blank",f.download=b,document.body.appendChild(f),f.click()}}}return{importFavorites:e,exportFavorites:f}}]),angular.module("n52.core.interface",["ngResource","n52.core.status"]).service("interfaceService",["$http","$q","statusService","settingsService","styleService","utils",function(a,b,c,d,e,f){function g(a,b){return e.createStylesInTs(a),a.apiUrl=b,a.internalId=f.createInternalId(a.id,b),a}var h=function(a){return angular.isUndefined(a)?a=d.additionalParameters:angular.extend(a,d.additionalParameters),{params:a,cache:!0}},i=function(a){return null===a?"":a};this.getServices=function(b){return a.get(b+"services",h({expanded:!0}))},this.getStations=function(b,c,d){return a.get(c+"stations/"+i(b),h(d))},this.getPhenomena=function(b,c,d){return a.get(c+"phenomena/"+i(b),h(d))},this.getCategories=function(b,c,d){return a.get(c+"categories/"+i(b),h(d))},this.getFeatures=function(b,c,d){return a.get(c+"features/"+i(b),h(d))},this.getProcedures=function(b,c,d){return a.get(c+"procedures/"+i(b),h(d))},this.getTimeseries=function(c,d,e){return angular.isUndefined(e)&&(e={}),e.expanded=!0,e.force_latest_values=!0,e.status_intervals=!0,e.rendering_hints=!0,b(function(b,f){a.get(d+"timeseries/"+i(c),h(e)).success(function(a){angular.isArray(a)?angular.forEach(a,function(a){g(a,d)}):b(g(a,d))})})},this.getTsData=function(b,d,e,f,g){var j={timespan:e,generalize:c.status.generalizeData||!1,expanded:!0,format:"flot"};return g&&angular.extend(j,g),a.get(d+"timeseries/"+i(b)+"/getData",h(j))}}]),angular.module("n52.core.permalinkGen",["n52.core.timeseries"]).factory("permalinkGenerationService",["$location","timeseriesService","timeService",function(a,b,c){return createTimeseriesParam=function(){var a=[];return angular.forEach(b.getAllTimeseries(),function(b){a.push(b.internalId)}),"ts="+encodeURIComponent(a.join())},createTimeParam=function(){return"timespan="+encodeURIComponent(c.getCurrentTimespan())},getCurrentPermalink=function(){var b,c=[],d=a.absUrl();return b=d.indexOf("?")>0?a.absUrl().substring(0,a.absUrl().indexOf("?")):a.absUrl(),b+="?",c.push(createTimeParam()),c.push(createTimeseriesParam()),b+c.join("&")},{getCurrentPermalink:getCurrentPermalink}}]),angular.module("n52.core.permalinkEval",["n52.core.utils"]).factory("permalinkEvaluationService",["$location","utils",function(a,b){var c=a.search();return hasParam=function(a,b){return angular.isDefined(b[a])},getParam=function(a){return hasParam(a,c)?c[a]:null},getTime=function(){if(hasParam("timespan",c)){var a=c.timespan.split("/"),b={};return b.start=moment(a[0]),b.end=moment(a[1]),b.duration=moment.duration(b.end.diff(b.start)),b}return null},getTimeseries=function(){if(hasParam("ts",c)){var a={};return angular.forEach(c.ts.split(","),function(c){var d=b.getTimeseriesCombinationByInternalId(c);Object.keys(d).length>0&&(a[c]=d)}),a}return null},{getParam:getParam,getTime:getTime,getTimeseries:getTimeseries}}]),angular.module("n52.core.settings",[]).service("settingsService",["config",function(a){var b={providerBlackList:[{serviceID:"srv_6d9ccea8d609ecb74d4a512922bb7cee",apiUrl:"http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v1/"},{serviceID:"srv_7cabc8c30a85fab035c95882df6db343",apiUrl:"http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v1/"},{serviceID:"srv_7cabc8c30a85fab035c95882df6db343",apiUrl:"http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v1/"}],restApiUrls:{"http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v1/":"52nSensorweb","http://sosrest.irceline.be/api/v1/":"irceline","http://www.fluggs.de/sos2/api/v1/":"fluggs","http://sensors.geonovum.nl/sos/api/v1/":"geonovum"},defaultProvider:{serviceID:"srv_738111ed219f738cfc85be0c8d87843c",url:"http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v1/"},clusterStations:!0,generalizeData:!0,saveStatus:!1,concentrationMarker:!1,mapOptions:{},zoom:13,stationPopupDuration:1e4,dateformat:"DD.MM.YY HH:mm [h]",shortDateformat:"DD.MM.YY",ignoreAfterDuration:moment.duration(1,"y"),defaultMarkerColor:"#123456",timeseriesDataBuffer:moment.duration(2,"h"),defaultStartTimeExtent:{duration:moment.duration(1,"day"),end:moment().endOf("day")},defaultZeroScale:!1,defaultGroupedAxis:!0,additionalParameters:{locale:"de"},defaultLanguage:"en",saveStatusPossible:!0,pagesize:20,selectedLineWidth:5,commonLineWidth:2,chartOptions:{},colorList:["#1abc9c","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#d35400","#c0392b","#7f8c8d"],intervalList:[{label:"styleChange.barChartInterval.hour",caption:"byHour",value:1},{label:"styleChange.barChartInterval.day",caption:"byDay",value:24},{label:"styleChange.barChartInterval.week",caption:"byWeek",value:168},{label:"styleChange.barChartInterval.month",caption:"byMonth",value:720}],timeRangeData:{presets:[{name:"lastHour",label:"timeSelection.presets.lastHour",interval:{from:moment().subtract(1,"hours"),till:moment(),duration:moment.duration(1,"hours")}},{name:"today",label:"timeSelection.presets.today",interval:{from:moment().startOf("day"),till:moment().endOf("day"),duration:moment.duration(1,"days")}},{name:"yesterday",label:"timeSelection.presets.yesterday",interval:{from:moment().subtract(1,"days").startOf("day"),till:moment().subtract(1,"days").endOf("day"),duration:moment.duration(1,"days")}},{name:"todayYesterday",label:"timeSelection.presets.todayYesterday",interval:{from:moment().subtract(1,"days").startOf("day"),duration:moment.duration(2,"days")}},{name:"thisWeek",label:"timeSelection.presets.thisWeek",interval:{from:moment().startOf("week"),duration:moment.duration(1,"weeks")}},{name:"lastWeek",label:"timeSelection.presets.lastWeek",interval:{from:moment().subtract(1,"weeks").startOf("week"),till:moment().subtract(1,"weeks").endOf("week"),duration:moment.duration(1,"weeks")}},{name:"thisMonth",label:"timeSelection.presets.thisMonth",interval:{from:moment().startOf("month"),duration:moment.duration(1,"months")}},{name:"lastMonth",label:"timeSelection.presets.lastMonth",interval:{from:moment().subtract(1,"months").startOf("month"),till:moment().subtract(1,"months").endOf("month"),duration:moment.duration(1,"months")}},{name:"thisYear",label:"timeSelection.presets.thisYear",interval:{from:moment().startOf("year"),duration:moment.duration(1,"years")}},{name:"lastYear",label:"timeSelection.presets.lastYear",interval:{from:moment().subtract(1,"years").startOf("year"),till:moment().subtract(1,"years").endOf("year"),duration:moment.duration(1,"years")}}]},notifyOptions:{position:"bottom-left",fade_in_speed:1e3,fade_out_speed:1e3,time:2e3},wmsLayer:[],tileLayerUrl:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'},enableGeoSearch:!0,supportedLanguages:[{code:"de",label:"Deutsch"},{code:"en",label:"English"}]};return angular.merge(b,a),b}]),angular.module("n52.core.status",["LocalStorageModule","n52.core.settings"]).factory("statusService",["$rootScope","localStorageService","settingsService","permalinkEvaluationService",function(a,b,c,d){var e="status",f={apiProvider:c.defaultProvider,showLegend:!1,showPhenomena:!1,saveStatus:c.saveStatus,generalizeData:c.generalizeData,clusterStations:c.clusterStations,concentrationMarker:c.concentrationMarker,timeseries:{},timespan:{}};f.timespan.duration=c.defaultStartTimeExtent.duration||moment.duration(1,"day"),f.timespan.end=c.defaultStartTimeExtent.end||moment(),f.timespan.start=c.defaultStartTimeExtent.start||moment(f.timespan.end).subtract(f.timespan.duration);var g=a,h=b.get(e)||{};g.status=angular.extend(angular.copy(f),h);var i=d.getTime();i&&(g.status.timespan=i);var j=d.getTimeseries();return j&&(g.status.timeseries=j),g.$watch("status",function(a){a.saveStatus?b.set(e,a):b.remove(e)},!0),resetStatus=function(){angular.copy(f,g.status)},removeTimeseries=function(a){delete g.status.timeseries[a]},addTimeseries=function(a){g.status.timeseries[a.internalId]=a},getTimeseries=function(){return g.status.timeseries},{resetStatus:resetStatus,addTimeseries:addTimeseries,removeTimeseries:removeTimeseries,getTimeseries:getTimeseries,status:g.status}}]),angular.module("n52.core.styleTs",["n52.core.color","n52.core.time","n52.core.interface"]).factory("styleService",["$rootScope","settingsService","colorService",function(a,b,c){function d(a){a.styles={},a.styles.color=a.renderingHints&&a.renderingHints.properties.color||c.stringToColor(a.id),a.styles.visible=!0,a.styles.selected=!1,a.styles.zeroScaled=!1,a.styles.groupedAxis=!0,angular.forEach(a.referenceValues,function(a){a.color=c.stringToColor(a.referenceValueId)})}function e(b){b.styles.selected=!b.styles.selected,a.$emit("timeseriesChanged",b.internalId)}function f(b,c,d){b.styles.selected=c,d||a.$emit("timeseriesChanged",b.internalId)}function g(b){b.styles.visible=!b.styles.visible,a.$emit("timeseriesChanged",b.internalId)}function h(b,c){b.styles.color=c,a.$emit("timeseriesChanged",b.internalId)}function i(b){b.styles.zeroScaled=!b.styles.zeroScaled,a.$emit("timeseriesChanged",b.internalId)}function j(b){b.styles.groupedAxis=!b.styles.groupedAxis,a.$emit("timeseriesChanged",b.internalId)}function k(b,c){b.renderingHints.properties.interval=c.caption,b.renderingHints.properties.value=c.value,a.$emit("timeseriesChanged",b.internalId)}function l(){a.$emit("allTimeseriesChanged")}var m=[{label:"styleChange.barChartInterval.hour",caption:"byHour",value:1},{label:"styleChange.barChartInterval.day",caption:"byDay",value:24},{label:"styleChange.barChartInterval.week",caption:"byWeek",value:168},{label:"styleChange.barChartInterval.month",caption:"byMonth",value:720}],n=b.intervalList||m;return{createStylesInTs:d,notifyAllTimeseriesChanged:l,toggleSelection:e,setSelection:f,toggleTimeseriesVisibility:g,updateColor:h,updateZeroScaled:i,updateGroupAxis:j,updateInterval:k,intervalList:n}}]),angular.module("n52.core.time",["ngResource","n52.core.status"]).factory("timeService",["$rootScope","statusService","utils",function(a,b,c){function d(){return c.createRequestTimespan(l.start,l.end)}function e(a,b){l.start=a,l.end=b,l.duration=moment.duration(b.diff(a)),k()}function f(a){a.from&&(l.start=a.from),a.till&&(l.end=a.till),a.duration&&(l.duration=a.duration),a.from&&a.duration&&!a.till&&(l.end=moment(l.start).add(l.duration)),a.till&&a.duration&&!a.from&&(l.start=moment(l.end).subtract(l.duration)),k()}function g(){l.start=l.start.subtract(l.duration),l.end=l.end.subtract(l.duration),k()}function h(){l.start=l.start.add(l.duration),l.end=l.end.add(l.duration),k()}function i(a,b){l.end=moment(a),b&&l.end.endOf("day"),l.start=moment(l.end).subtract(l.duration),k()}function j(a,b){l.start=moment(a),b&&l.start.startOf("day"),l.end=moment(l.start).add(l.duration),k()}function k(){b.status.timespan=l,a.$emit("timeExtentChanged")}var l={duration:moment.duration(b.status.timespan.duration),start:moment(b.status.timespan.start),end:moment(b.status.timespan.end)};return{getCurrentTimespan:d,jumpToLastTimeStamp:i,jumpToFirstTimeStamp:j,setFlexibleTimeExtent:e,setPresetInterval:f,stepBack:g,stepForward:h,time:l}}]),angular.module("n52.core.timeseries",["n52.core.color","n52.core.time","n52.core.interface","n52.core.styleTs"]).factory("timeseriesService",["$rootScope","interfaceService","statusService","timeService",function(a,b,c,d){function e(){angular.forEach(t,function(a){g(a)})}function f(a){t[a.internalId]=a,c.addTimeseries(a),g(a)}function g(a){a.loadingData=!0,b.getTsData(a.id,a.apiUrl,d.getCurrentTimespan()).success(function(b){h(b,a)})}function h(b,c){u[c.internalId]=b[c.id],u[c.internalId].values&&u[c.internalId].values.length?c.hasDataInCurrentExtent=!1:c.hasDataInCurrentExtent=!0,a.$emit("timeseriesDataChanged",c.internalId),c.loadingData=!1}function i(a){return u[a]}function j(a){return t[a]}function k(){return t}function l(a){return angular.isObject(t[a])}function m(){return Object.keys(t).length}function n(a,c,d){b.getTimeseries(a,c,d).then(function(a){angular.isArray(a)?angular.forEach(a,function(a){f(a,c)}):f(a,c)})}function o(a){f(angular.copy(a))}function p(b){delete t[b],delete u[b],c.removeTimeseries(b),a.$emit("timeseriesDataChanged",b)}function q(){angular.forEach(t,function(a){p(a.internalId)})}function r(b,c){b.visible=!b.visible,a.$emit("timeseriesDataChanged",c)}function s(a){return l(a)&&t[a].styles.visible}var t={},u={};return angular.forEach(c.getTimeseries(),function(a){n(a.id,a.apiUrl)}),a.$on("timeExtentChanged",function(a){e()}),{addTimeseriesById:n,addTimeseries:o,removeTimeseries:p,removeAllTimeseries:q,toggleReferenceValue:r,isTimeseriesVisible:s,getData:i,getTimeseries:j,getAllTimeseries:k,hasTimeseries:l,getTimeseriesCount:m,timeseries:t}}]),angular.module("n52.core.translate",["n52.core.permalinkEval"]).service("translateService",["$translate","permalinkEvaluationService",function(a,b){var c=b.getParam("lang");return angular.isString(c)&&a.use(c),{}}]),angular.module("n52.core.utils",["n52.core.settings"]).factory("utils",["$window","settingsService",function(a,b){function c(){var b=null!==a.navigator.userAgent.match(/(iPad|iPhone|iPod)/g);return a.File&&a.FileReader&&a.Blob&&!b}function d(a,c){return b.restApiUrls[c]+"__"+a}function e(a,b){return moment(a).format()+"/"+moment(b).format()}function f(a){var c={};return angular.forEach(b.restApiUrls,function(b,d){0===a.indexOf(b)&&(c={id:a.substring(a.indexOf("__")+2,a.length),apiUrl:d})}),c}return{createRequestTimespan:e,getTimeseriesCombinationByInternalId:f,createInternalId:d,isFileAPISupported:c}}]);